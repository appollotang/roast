<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Bio-Rater | Cyberpunk Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://www.paypal.com/sdk/js?client-id=BAAl2FqcC5YdWD2QktmDi7Htp0WAzhYwOL7a4YxHutJBsJOKPB2iLvwexvs6mlE8a7iQ1O3B9DmEAV4wXc&components=hosted-buttons&enable-funding=venmo&currency=USD"></script>

    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;600&family=Bangers&family=Oswald:wght@700&display=swap" rel="stylesheet">
    
    <style>
        /* --- CYBERPUNK THEME Teehaw --- */
        body {
            background-color: #050505;
            font-family: 'Inter', sans-serif;
            color: #e0e0e0;
            background-image: radial-gradient(circle at 50% 50%, #2e0b0b 0%, #000000 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }
        
        /* Neon Effects */
        .neon-text-orange { text-shadow: 0 0 10px #ff3300, 0 0 20px #ff3300; color: #ff3300; }
        .neon-border-orange { box-shadow: 0 0 15px rgba(255, 51, 0, 0.3); border: 1px solid #ff3300; }
        
        .font-cyber { font-family: 'Orbitron', sans-serif; }
        .font-banger { font-family: 'Bangers', cursive; }

        /* Pulsing Button */
        .pulse-btn { animation: pulse-glow 2s infinite; }
        @keyframes pulse-glow {
            0% { box-shadow: 0 0 0 0 rgba(255, 51, 0, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(255, 51, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 51, 0, 0); }
        }

        /* Glitch Effect */
        .glitch-hover:hover {
            animation: glitch 0.3s cubic-bezier(.25, .46, .45, .94) both infinite;
            color: #ff3300;
        }
        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }

        /* Matrix Loader */
        .matrix-text { font-family: 'Courier New', monospace; color: #ff3300; }

        /* Blur Lock */
        .lock-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 10;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen items-center justify-center p-4">

    <div id="landing-section" class="max-w-2xl w-full text-center space-y-8 relative z-10 mx-auto">
        <h1 class="text-6xl md:text-8xl font-black font-cyber tracking-tighter mb-2 leading-none">
            <span class="neon-text-orange">IS YOUR BIO</span><br>
            <span class="text-white glitch-hover">TRASH?</span>
        </h1>
        
        <div class="bg-gray-900/80 p-8 rounded-2xl neon-border-orange backdrop-blur-md space-y-6 text-center shadow-2xl">
            
            <div class="w-full">
                <label class="text-xs font-cyber text-gray-400 uppercase tracking-widest block mb-2 text-left">Select Platform</label>
                <div class="relative">
                    <select id="platform" class="w-full bg-black border border-gray-700 text-white p-4 rounded-lg focus:outline-none focus:border-[#ff3300] appearance-none font-bold text-lg">
                        <option value="TikTok">TikTok</option>
                        <option value="Instagram">Instagram</option>
                        <option value="X (Twitter)">X (Twitter)</option>
                        <option value="YouTube">YouTube</option>
                        <option value="Facebook">Facebook</option>
                        <option disabled>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</option>
                        <option value="LinkedIn">LinkedIn</option>
                        <option value="Snapchat">Snapchat</option>
                        <option value="Tinder">Tinder</option>
                    </select>
                    <div class="absolute right-4 top-4 pointer-events-none text-[#ff3300]">‚ñº</div>
                </div>
            </div>

            <div class="w-full">
                <label class="text-xs font-cyber text-gray-400 uppercase tracking-widest block mb-2 text-left">Target Handle</label>
                <input type="text" id="handle" placeholder="@username" class="w-full bg-black border border-gray-700 text-white p-4 rounded-lg focus:outline-none focus:border-[#ff3300] text-lg font-mono text-center">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-left">
                <textarea id="bioText" placeholder="(Optional) Paste bio text..." class="bg-black border border-gray-700 text-gray-300 p-3 rounded-lg h-24 text-sm resize-none"></textarea>
                
                <div class="file-upload border-2 border-dashed border-gray-700 hover:border-[#ff3300] rounded-lg flex flex-col items-center justify-center cursor-pointer transition-colors bg-black/50 p-2" onclick="document.getElementById('userImage').click()">
                    <span class="text-2xl">üì∏</span>
                    <span class="text-xs text-gray-500 mt-1 uppercase font-bold">Upload Pic</span>
                    <span id="img-status" class="text-[10px] text-[#00ffcc] hidden">Loaded!</span>
                    <input type="file" id="userImage" accept="image/*" class="hidden" onchange="previewImage(this)">
                </div>
            </div>

            <button onclick="startRoastSequence()" class="w-full bg-[#ff3300] text-black font-black font-cyber text-2xl p-5 rounded-lg hover:bg-[#cc2900] transition-all transform hover:scale-[1.02] pulse-btn shadow-[0_0_20px_rgba(255,51,0,0.5)]">
                ROAST ME üî•
            </button>
        </div>
    </div>

    <div id="loading-section" class="hidden fixed inset-0 bg-black/95 z-50 flex flex-col items-center justify-center">
        <div class="w-full max-w-md text-center space-y-6 px-4">
            <div class="text-[#ff3300] font-mono text-xl matrix-text" id="matrix-msg">INITIALIZING...</div>
            <div class="w-full bg-gray-800 h-2 rounded-full overflow-hidden">
                <div id="progress-bar" class="bg-[#ff3300] h-full w-0 transition-all duration-300"></div>
            </div>
            
            <div id="cringe-warning" class="hidden transform scale-0 transition-transform duration-300 bg-red-600 text-white font-black p-4 border-4 border-yellow-400 rotate-3 shadow-[0_0_50px_red] text-2xl uppercase">
                ‚ö†Ô∏è WARNING: HIGH CRINGE DETECTED
            </div>
        </div>
    </div>

    <div id="report-section" class="hidden max-w-4xl w-full space-y-8 animate-fade-in pb-20 mx-auto">
        
        <div class="flex flex-col md:flex-row gap-6">
            <div class="bg-black border-2 border-red-600 p-6 rounded-2xl w-full md:w-1/3 flex flex-col items-center justify-center shadow-[0_0_30px_rgba(255,0,0,0.3)]">
                <h3 class="text-gray-500 font-cyber text-xs uppercase">Roast Score</h3>
                <div id="score-display" class="text-8xl font-black text-red-600 font-impact leading-none mt-2">0.0</div>
                <div class="text-red-400 text-sm font-bold mt-2 tracking-widest">CRITICAL FAILURE</div>
            </div>

            <div class="bg-gray-900/80 border border-gray-700 p-8 rounded-2xl w-full md:w-2/3 flex flex-col justify-center">
                <div class="text-[#ff3300] font-cyber text-xs uppercase mb-2">Analysis Complete</div>
                <p id="roast-text" class="text-xl md:text-2xl font-medium leading-relaxed text-gray-200 italic">
                    "..."
                </p>
            </div>
        </div>

        <div class="bg-black/50 border-l-4 border-[#ff3300] p-6 rounded-r-xl">
            <h3 class="text-[#ff3300] font-cyber font-bold uppercase mb-4">Suggested Remedies:</h3>
            <ul id="remedies-list" class="space-y-3 text-gray-400 list-disc list-inside font-mono text-sm"></ul>
        </div>

        <div class="space-y-6">
            <h2 class="text-3xl font-cyber font-bold text-center neon-text-orange">VIRAL CONTENT LAB</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                
                <div class="bg-gray-900 border border-gray-700 p-4 rounded-xl relative group col-span-1 md:col-span-3 lg:col-span-1">
                    <div class="absolute -top-3 left-4 bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded">OPTION A: VIDEO REACTION</div>
                    
                    <div class="flex space-x-2 mt-4 mb-2 justify-center">
                        <button onclick="changeVideo('turkey')" class="text-2xl hover:scale-125 transition" title="Turkey">ü¶É</button>
                        <button onclick="changeVideo('pig')" class="text-2xl hover:scale-125 transition" title="Pig">üê∑</button>
                        <button onclick="changeVideo('marshmallow')" class="text-2xl hover:scale-125 transition" title="Marshmallow">‚ñ´Ô∏è</button>
                        <button onclick="changeVideo('chilli')" class="text-2xl hover:scale-125 transition" title="Chilli">üå∂Ô∏è</button>
                    </div>

                    <div class="relative w-full aspect-[9/16] bg-black rounded-lg overflow-hidden border border-gray-600">
                        <video id="roast-video" class="absolute inset-0 w-full h-full object-cover opacity-95" autoplay loop playsinline controls>
                            <source src="" type="video/mp4">
                        </video>

                        <div class="absolute inset-0 flex flex-col justify-between items-center p-3 text-center z-10 pointer-events-none">
                            
                            <h3 class="text-white font-cyber font-black text-xl mt-2 drop-shadow-[0_2px_2px_rgba(0,0,0,0.8)]">
                                POV: YOU GOT ROASTED
                            </h3>

                            <div class="flex flex-col items-center w-full mb-10">
                                <p id="video-overlay-text" class="text-white font-bold font-mono text-sm p-1 drop-shadow-[0_2px_2px_rgba(0,0,0,0.8)] mb-1">
                                    "Waiting for roast..."
                                </p>
                                <div class="text-[#00ffcc] font-bold text-xs font-mono drop-shadow-md">
                                    tiktok.com/@biorater
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-2 mt-3">
                        <button onclick="downloadVideoAsset()" class="bg-blue-600 hover:bg-blue-500 text-white text-xs py-2 rounded font-bold">‚¨áÔ∏è Download</button>
                        <button onclick="copyOverlayText()" class="bg-gray-700 hover:bg-gray-600 text-white text-xs py-2 rounded">üìã Copy Text</button>
                    </div>
                    <p class="text-[10px] text-gray-500 text-center mt-2">Download video + paste text in TikTok/Reels</p>
                </div>

                <div class="bg-gray-900 border border-[#ff3300] p-4 rounded-xl relative flex flex-col items-center shadow-[0_0_20px_rgba(255,51,0,0.2)]">
                    <div class="absolute -top-3 left-4 bg-[#ff3300] text-black text-xs font-bold px-2 py-1 rounded">OPTION B: MEME</div>
                    
                    <canvas id="memeCanvas" width="400" height="550" class="w-full h-auto rounded mt-4 border border-gray-600"></canvas>
                    
                    <div id="content-lock" class="lock-overlay rounded mt-4" style="top: 3rem; height: calc(100% - 4rem);">
                        <div class="text-center p-4 w-full">
                            <div class="text-4xl mb-4">üîí</div>
                            <h3 class="font-bold text-white mb-4 text-xl font-cyber">UNLOCK PACK</h3>
                            <button onclick="unlockContent()" class="bg-[#ff3300] text-black font-bold text-sm px-6 py-3 rounded hover:bg-white mb-4 w-full transition-colors">Share to X (Free)</button>
                            
                            <div class="w-full flex justify-center">
                                <div id="paypal-container-UCMF4R2NDYKJJ" class="w-full"></div>
                            </div>
                        </div>
                    </div>

                    <button id="download-btn" onclick="downloadCard()" class="w-full mt-4 bg-[#ff3300] text-black font-bold py-3 rounded blur-sm pointer-events-none transition-all">Download HD</button>
                </div>

                <div class="bg-gray-900 border border-gray-700 p-4 rounded-xl relative">
                    <div class="absolute -top-3 left-4 bg-green-600 text-white text-xs font-bold px-2 py-1 rounded">OPTION C: CAPTION</div>
                    <h4 class="text-gray-400 text-xs uppercase mt-4 mb-2">Clipboard Ready</h4>
                    <textarea id="caption-text" class="w-full bg-black text-white text-sm p-3 rounded h-32 resize-none border border-gray-800" readonly></textarea>
                    <button class="w-full mt-4 bg-gray-800 hover:bg-gray-700 text-white text-xs py-2 rounded" onclick="copyCaption()">Copy Caption</button>
                </div>
            </div>
        </div>
        
        <div class="text-center pt-10">
            <button onclick="location.reload()" class="text-gray-500 hover:text-[#ff3300] text-sm underline pb-10">Roast Another Profile</button>
        </div>
    </div>

    <script>
        // *** PASTE YOUR GOOGLE SCRIPT URL BELOW ***
        const API_URL = "https://script.google.com/macros/s/AKfycbzVl0t9JB9SzuMYiX8IiO-MS-f7dsBSlV4clArZt6ra8wD7_UH_idaBx7QpyQIyNgTv/exec"; 

        // VIDEO ASSETS (Using Correct Raw GitHub URLs)
        const videoAssets = {
            'turkey': 'https://raw.githubusercontent.com/appollotang/roast/main/turkey.mp4',
            'pig': 'https://raw.githubusercontent.com/appollotang/roast/main/pig.mp4',
            'marshmallow': 'https://raw.githubusercontent.com/appollotang/roast/main/marshmallow.mp4',
            'chilli': 'https://raw.githubusercontent.com/appollotang/roast/main/chilli.mp4'
        };

        // IMAGE ASSET (For the Card Background)
        const fireCardBgUrl = "https://raw.githubusercontent.com/appollotang/roast/main/fire.jpg";

        let currentVideoKey = 'turkey'; // Default to turkey
        let userUploadedImg = null;
        let fireBgImg = new Image(); // The fire.jpg background
        let roastData = null;

        // PRELOAD ASSETS
        fireBgImg.crossOrigin = "Anonymous";
        fireBgImg.src = fireCardBgUrl;
        
        // Initialize default video
        window.onload = function() {
            changeVideo('turkey');
        };

        function previewImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => { 
                        userUploadedImg = img; 
                        document.getElementById('img-status').classList.remove('hidden');
                    };
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        async function startRoastSequence() {
            const handle = document.getElementById('handle').value;
            const platform = document.getElementById('platform').value;
            
            if (!handle) return alert("ENTER A HANDLE OR GET OUT.");

            document.getElementById('landing-section').classList.add('hidden');
            document.getElementById('loading-section').classList.remove('hidden');
            
            runMatrixLoader();

            try {
                const response = await fetch(API_URL, {
                    method: "POST",
                    body: JSON.stringify({ 
                        platform: platform, 
                        handle: handle, 
                        bioText: document.getElementById('bioText').value 
                    })
                });
                const data = await response.json();
                
                if (data.status === 'success') {
                    roastData = data.data;
                    setTimeout(() => {
                        revealResults(platform, handle);
                    }, 3500); 
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                alert("AI Overload. The backend might be sleeping. Try again.");
                location.reload();
            }
        }

        function runMatrixLoader() {
            const msgs = ["SCRAPING SOCIAL GRAPH...", "ANALYZING CRINGE VECTORS...", "CONSULTING GEN Z COUNCIL...", "CALCULATING L RATIO...", "FINALIZING DESTRUCTION..."];
            const msgDiv = document.getElementById('matrix-msg');
            const bar = document.getElementById('progress-bar');
            let i = 0;
            const interval = setInterval(() => { if(i < msgs.length) { msgDiv.innerText = msgs[i]; i++; } }, 600);
            setTimeout(() => { bar.style.width = "100%"; }, 100);
            setTimeout(() => {
                const warning = document.getElementById('cringe-warning');
                warning.classList.remove('hidden'); warning.classList.remove('scale-0'); warning.classList.add('scale-100');
            }, 2500);
        }

        function revealResults(platform, handle) {
            document.getElementById('loading-section').classList.add('hidden');
            document.getElementById('report-section').classList.remove('hidden');
            document.getElementById('score-display').innerText = roastData.score + "/10";
            document.getElementById('roast-text').innerText = '"' + roastData.roast + '"';
            
            // Set Video Overlay Text
            document.getElementById('video-overlay-text').innerText = roastData.roast;

            const list = document.getElementById('remedies-list');
            list.innerHTML = '';
            roastData.remedies.forEach(r => {
                const li = document.createElement('li');
                li.innerText = r;
                list.appendChild(li);
            });

            document.getElementById('caption-text').value = `${roastData.meme_text} üíÄ Score: ${roastData.score}/10 @${handle} #BioRater`;
            
            drawCard(roastData.score, handle, roastData.roast);
        }

        // --- VIDEO FUNCTIONS ---
        function changeVideo(character) {
            const videoEl = document.getElementById('roast-video');
            currentVideoKey = character;
            if (videoAssets[character]) {
                videoEl.src = videoAssets[character];
                videoEl.play();
            } else {
                console.error("Video asset not found for:", character);
            }
        }

        function downloadVideoAsset() {
            const link = document.createElement('a');
            link.href = videoAssets[currentVideoKey];
            link.download = `biorater-${currentVideoKey}.mp4`;
            link.click();
        }

        function copyOverlayText() {
            const text = document.getElementById('video-overlay-text').innerText;
            navigator.clipboard.writeText(text);
            alert("Overlay text copied! Paste it in TikTok.");
        }

        // --- CANVAS MEME CARD ---
        function drawCard(score, handle, roastText) {
            const canvas = document.getElementById('memeCanvas');
            const ctx = canvas.getContext('2d');

            // 1. Background (Draw fire.jpg)
            try {
                // Draw the fire background image to fill the canvas
                ctx.drawImage(fireBgImg, 0, 0, canvas.width, canvas.height);
                
                // Add a semi-transparent black overlay to make text readable
                ctx.fillStyle = "rgba(0, 0, 0, 0.4)"; 
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            } catch (e) {
                // Fallback if fire.jpg fails
                ctx.fillStyle = "#ffffff";
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
            
            // 2. Black Border
            ctx.strokeStyle = "#000";
            ctx.lineWidth = 10;
            ctx.strokeRect(5, 5, canvas.width-10, canvas.height-10);

            // 3. User Image Area
            if (userUploadedImg) {
                ctx.drawImage(userUploadedImg, 60, 120, 280, 280);
                ctx.lineWidth = 4;
                ctx.strokeStyle = "#ff3300"; // Neon orange border for user img
                ctx.strokeRect(60, 120, 280, 280);
            } else {
                ctx.fillStyle = "#eee";
                ctx.fillRect(60, 120, 280, 280);
                ctx.fillStyle = "#000";
                ctx.font = "20px Arial";
                ctx.textAlign = "center";
                ctx.fillText("NO IMAGE", 200, 260);
            }

            // 4. "ROASTED" Logo
            ctx.textAlign = "center";
            ctx.font = "900 85px 'Bangers'";
            ctx.fillStyle = "black";
            ctx.fillText("ROASTED", 205, 95);
            ctx.lineWidth = 6;
            ctx.strokeStyle = "#8b0000"; 
            ctx.strokeText("ROASTED", 200, 90);
            let gradient = ctx.createLinearGradient(0, 50, 0, 100);
            gradient.addColorStop(0, "#ffeb3b");
            gradient.addColorStop(0.5, "#ff0000");
            ctx.fillStyle = gradient;
            ctx.fillText("ROASTED", 200, 90);

            // 5. Score & Handle (White text with shadow for readability on fire bg)
            ctx.shadowColor = "black";
            ctx.shadowBlur = 5;
            
            ctx.fillStyle = "#ffffff";
            ctx.font = "bold 24px 'Oswald'";
            ctx.fillText("@" + handle.toUpperCase(), 200, 440);
            
            ctx.font = "18px Arial";
            ctx.fillStyle = "#eeeeee";
            ctx.fillText("Your Roast Score:", 200, 470);

            ctx.shadowBlur = 0; // Reset shadow for score
            ctx.fillStyle = "#ff3300"; // Neon Orange Score
            ctx.font = "900 80px 'Oswald'";
            ctx.fillText(score + "/10", 200, 540);

            // 6. Side Vertical Text
            ctx.save();
            ctx.translate(40, 400);
            ctx.rotate(-Math.PI/2);
            ctx.fillStyle = "#ffffff";
            ctx.font = "bold 16px Arial";
            ctx.fillText("AI BIO ROAST :: " + roastText.substring(0,25) + "...", 0, 0);
            ctx.restore();
        }

        function unlockContent() {
            const text = "I just got roasted by AI Bio-Rater! Try it here: https://biorater.ai";
            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`, '_blank');
            document.getElementById('content-lock').classList.add('hidden');
            const btn = document.getElementById('download-btn');
            btn.classList.remove('blur-sm', 'pointer-events-none');
            btn.classList.add('pulse-btn');
            btn.innerText = "DOWNLOAD IMAGE ‚¨áÔ∏è";
        }

        function downloadCard() {
            const link = document.createElement('a');
            link.download = 'bio-roast.jpg';
            link.href = document.getElementById('memeCanvas').toDataURL();
            link.click();
        }

        function copyCaption() {
            const text = document.getElementById('caption-text').value;
            navigator.clipboard.writeText(text);
            alert("Caption Copied!");
        }
    </script>

    <script>
      paypal.HostedButtons({
        hostedButtonId: "UCMF4R2NDYKJJ",
      }).render("#paypal-container-UCMF4R2NDYKJJ")
    </script>

</body>
</html>
